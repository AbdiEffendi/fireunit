<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
          "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<script src="utils.js" type="text/javascript"></script>
<script src="env.js" type="text/javascript"></script>
<script>
netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");

// Get current value of the showXMLHttpRequests preference. This one 
// must be set to false in this test, byt the original value is reverted.
var prefOrigValue = fireunit.Firebug.getPref(prefDomain, "showXMLHttpRequests");
fireunit.Firebug.setPref(prefDomain, "showXMLHttpRequests", false);

var request = new XMLHttpRequest();
request.onreadystatechange = function () {
    if (request.readyState == 4 && request.status == 200)
        setTimeout(function() {
            checkResponseTab(request);
        }, layoutTimeout);
};

request.open("GET", "issue601.txt", true);
request.send(null);

function checkResponseTab(request)
{
    netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
    fireunit.FBTrace.sysout("fireunit.issue601.checkResponseTab", request);

    // Open Firebug UI and activate Net panel.
    fireunit.Firebug.showBar(true);
    fireunit.FirebugChrome.selectPanel("net");

    // Get Net panel content
    var panelNode = fireunit.panel("net");
    fireunit.ok(panelNode, "Net panel must exist.");

    // Expand Net's panel UI so, it's populated with data.
    expandNetRows(panelNode, "netRow");
    expandNetTabs(panelNode, "netInfoResponseTab");

    var infoBodyRow = fireunit.FBL.getElementByClass(panelNode, "netInfoBody", "category-xhr");
    fireunit.ok(infoBodyRow, "Info body must be created at this moment.");
    if (infoBodyRow) {
        var responseBody = fireunit.FBL.getElementByClass(infoBodyRow, "netInfoResponseText");
        fireunit.ok(responseBody, "Response tab must exist.");
        fireunit.ok(responseBody.firstChild.firstChild, "Response text node must exist.");  
        
        fireunit.FBTrace.sysout("fireunit.issue601.node with response text", 
            responseBody.firstChild.firstChild);
        
        if (responseBody.firstChild.firstChild) {
            fireunit.compare("Response for test_issue601.htm", 
                responseBody.firstChild.firstChild.nodeValue, 
                "Test response must match.");
        }
    }
      
    // Finish test
    fireunit.Firebug.setPref(prefDomain, "showXMLHttpRequests", prefOrigValue);
    fireunit.FBTrace.sysout("fireunit.issue601.DONE");    
    fireunit.testDone();    
}
</script>
</head>
<body>
<h1>Test Case for Issue #601</h1>
</body>
</html>
